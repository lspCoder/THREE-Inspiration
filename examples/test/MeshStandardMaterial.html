<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../libs/three.js"></script>
    <script src="../libs/dat.gui.min.js"></script>
    <script src="../libs/OrbitControls.js"></script>
</head>

<body>
    <script>
        var container, stats;

        var camera, scene, renderer, controls;
        var particleLight;
        var gui = new dat.GUI();

        var params = {
            bumpScale: 1,
            color: new THREE.Color(0.5, 0.2, 0.4),
            metalness: 0.4,
            roughness: 0.4,
        }

        init();
        animate();

        function init() {
            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.set(0.0, 400, 400 * 3.5);

            scene = new THREE.Scene();

            var material = new THREE.MeshStandardMaterial({
                bumpScale: params.bumpScale,
                color: params.color,
                metalness: params.metalness,
                roughness: params.roughness,
            });

            var geometry = new THREE.SphereBufferGeometry( 5, 32, 16 );
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(400, 400, 400);

            particleLight = new THREE.Mesh(new THREE.SphereBufferGeometry(4, 8, 8), new THREE.MeshBasicMaterial({
                color: 0xffffff
            }));
            scene.add(particleLight);

            // Lights

            scene.add(new THREE.AmbientLight(0x222222));

            var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);

            var pointLight = new THREE.PointLight(0xffffff, 2, 800);
            particleLight.add(pointLight);

            //

            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            renderer.gammaInput = true;
            renderer.gammaOutput = true;
            renderer.toneMapping = THREE.Uncharted2ToneMapping;
            renderer.toneMappingExposure = 0.75;


            controls = new THREE.OrbitControls(camera, renderer.domElement);

            guiMeshStandardMaterial(gui, mesh, material, geometry);

            function guiMeshStandardMaterial(gui, mesh, material, geometry) {

                var data = {
                    color: material.color.getHex(),
                    emissive: material.emissive.getHex(),
                    envMaps: envMapKeys[0],
                    map: diffuseMapKeys[0],
                    roughnessMap: roughnessMapKeys[0],
                    alphaMap: alphaMapKeys[0]
                };

                var folder = gui.addFolder('THREE.MeshStandardMaterial');

                folder.addColor(data, 'color').onChange(handleColorChange(material.color));
                folder.addColor(data, 'emissive').onChange(handleColorChange(material.emissive));

                folder.add(material, 'roughness', 0, 1);
                folder.add(material, 'metalness', 0, 1);
                folder.add(material, 'flatShading').onChange(needsUpdate(material, geometry));
                folder.add(material, 'wireframe');
                folder.add(material, 'wireframeLinewidth', 0, 10);
                // folder.add(data, 'envMaps', envMapKeys).onChange(updateTexture(material, 'envMap', envMaps));
                // folder.add(data, 'map', diffuseMapKeys).onChange(updateTexture(material, 'map', diffuseMaps));
                // folder.add(data, 'roughnessMap', roughnessMapKeys).onChange(updateTexture(material, 'roughnessMap',
                //     roughnessMaps));
                // folder.add(data, 'alphaMap', alphaMapKeys).onChange(updateTexture(material, 'alphaMap', alphaMaps));

                // TODO metalnessMap

            }

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        //

        function animate() {

            requestAnimationFrame(animate);

            render();
            stats.update();

        }

        function render() {

            var timer = Date.now() * 0.00025;

            //camera.position.x = Math.cos( timer ) * 800;
            //camera.position.z = Math.sin( timer ) * 800;

            camera.lookAt(scene.position);

            particleLight.position.x = Math.sin(timer * 7) * 300;
            particleLight.position.y = Math.cos(timer * 5) * 400;
            particleLight.position.z = Math.cos(timer * 3) * 300;

            renderer.render(scene, camera);

        }
    </script>
</body>

</html>
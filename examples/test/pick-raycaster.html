<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>

<body>
    <script>
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2(10, 10);
        var scene = new THREE.Scene();
        //背景色
        scene.background = new THREE.Color(0xffffff);
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 20;

        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        //高分屏
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // 添加鼠标控制
        var controls = new THREE.OrbitControls(camera, renderer.domElement);

        var planeGeometry = new THREE.PlaneBufferGeometry(window.innerWidth, window.innerHeight, 1, 1);
        var planeMaterial = new THREE.MeshBasicMaterial({
            color: 0x2194ce,
        });
        var planeMesh = new THREE.Mesh(planeGeometry, planeMaterial);
        planeMesh.position.set(0, 0, 0);
        // scene.add(planeMesh);

        var geometry = new THREE.BoxGeometry(1, 1, 1);
        var material = new THREE.MeshBasicMaterial({
            color: 0x00ff00
        });
        var cube = new THREE.Mesh(geometry, material);
        cube.position.set(0, 0, 10);
        scene.add(cube);

        var ballTexture = THREE.ImageUtils.loadTexture( '../images/redball.png' );

        var ballMaterial = new THREE.SpriteMaterial( { map: ballTexture } );
        ballSprite = new THREE.Sprite( ballMaterial );
        ballSprite.position.set( 50, 50, 0 );
        scene.add( ballSprite );

        // 自适应窗口
        function resize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.addEventListener("resize", resize);
        window.addEventListener("mousemove", onDocumentMouseMove);

        function animate() {
            requestAnimationFrame(animate);
            render();
        }
        animate();

        function render() {
            planeMesh.lookAt(camera.position);
            controls.update();
            raycaster.setFromCamera(mouse, camera);
            var intersects = raycaster.intersectObject(planeMesh);
            if (intersects.length > 0) {
                if (intersects[0].object) {
                    // console.log(intersects[0].point);
                    ballSprite.position.copy(intersects[0].point);
                }
            }
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            renderer.render(scene, camera);
        }

        function transToThreeCoord(x, y) {
            let mouse = new THREE.Vector3();
            mouse.x = (x / window.innerWidth) * 2 - 1;
            mouse.y = -(y / window.innerHeight) * 2 + 1;
            return mouse;
        }

        /**
         * 将three.js三维坐标转换成屏幕上的二维坐标
         * @param THREE.Vector3 vector three.js三维坐标
         * @return {x:int,y:int} 屏幕坐标
         */
        function transToScreenCoord(vector) {
            var screenCoord = {};
            vector.project(camera);
            screenCoord.x = (0.5 + vector.x / 2) * window.innerWidth;
            screenCoord.y = (0.5 - vector.y / 2) * window.innerHeight;
            return screenCoord;
        }


        function convertTo3DCoordinate(clientX, clientY) {
            var mv = new THREE.Vector3(
                (clientX / window.innerWidth) * 2 - 1,
                -(clientY / window.innerHeight) * 2 + 1,
                0);
            mv.unproject(this.camera); //这句将一个向量转成threejs坐标
            return mv;
        }

        function onDocumentMouseMove(event) {
            event.preventDefault();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }


        // dat gui
        var gui = new dat.GUI();
        var cameraGui = gui.addFolder("camera position");
        cameraGui.add(camera.position, 'x');
        cameraGui.add(camera.position, 'y');
        cameraGui.add(camera.position, 'z');
        cameraGui.open();

        var cameraGui = gui.addFolder("camera projection");
        cameraGui.add(camera, "fov");
        cameraGui.open();

        var cubeGui = gui.addFolder("cube position");
        cubeGui.add(cube.position, 'x');
        cubeGui.add(cube.position, 'y');
        cubeGui.add(cube.position, 'z');
        cubeGui.open();
    </script>
</body>

</html>